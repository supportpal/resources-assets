{"version":3,"file":"mergefields.min.js","sources":["../src/operator/mergefields/DOMParser.js","../src/operator/mergefields/index.js"],"sourcesContent":["/*\n   * DOMParser HTML extension\n   * 2012-09-04\n   *\n   * By Eli Grey, http://eligrey.com\n   * Public domain.\n   * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n   */\n\n/*! @source https://gist.github.com/1129031 */\nfunction DOMParser() {\n  \"use strict\";\n\n  var\n    proto = DOMParser.prototype\n    , nativeParse = proto.parseFromString\n  ;\n\n  // Firefox/Opera/IE throw errors on unsupported types\n  try {\n    // WebKit returns null on unsupported types\n    if ((new DOMParser()).parseFromString(\"\", \"text/html\")) {\n      // text/html parsing is natively supported\n      return;\n    }\n  } catch (ex) {}\n\n  proto.parseFromString = function(markup, type) {\n    if (/^\\s*text\\/html\\s*(?:;|$)/i.test(type)) {\n      var\n        doc = document.implementation.createHTMLDocument(\"\")\n      ;\n      if (markup.toLowerCase().indexOf('<!doctype') > -1) {\n        doc.documentElement.innerHTML = markup;\n      }\n      else {\n        doc.body.innerHTML = markup;\n      }\n      return doc;\n    } else {\n      return nativeParse.apply(this, arguments);\n    }\n  };\n}\n\nexport {DOMParser}\n","import {DOMParser} from \"./DOMParser.js\";\n\n/**\n * Merge fields.\n *\n * @param parameters\n * @constructor\n */\nfunction MergeFields(parameters)\n{\n  \"use strict\";\n\n  var instance = this;\n\n  /**\n   * Options.\n   */\n  var $container, $toolbar, $preview, $editor,\n    valFn = parameters.valFn;\n\n  /**\n   * List of node attributes that are permitted to contain twig template code.\n   */\n  var whitelisted = {\n    'img': [ 'src' ],\n    'a': [ 'href' ]\n  };\n\n  /**\n   * HTML used to wrap plugin contents in the DOM.\n   *\n   * Use $.wrap() with this function.\n   *\n   * @returns {string}\n   * @private\n   */\n  var createContainer = function () {\n    return '<div class=\"sp-editor-container\"></div>';\n  };\n\n  /**\n   * Create the textarea toolbar.\n   *\n   * @returns {string}\n   * @private\n   */\n  var createToolbar = function () {\n    return '' +\n      '<div class=\"sp-inline-block sp-mt-3\">' +\n        '<button class=\"switch-view visual-preview\" type=\"button\">' +\n          Lang.get('general.preview') +\n        '</button>' +\n        '<button class=\"switch-view code-editor sp-hidden\" type=\"button\">' +\n          Lang.get('general.editor') +\n        '</button>' +\n      '</div>';\n  };\n\n  /**\n   * Create the preview HTML.\n   *\n   * @returns {string}\n   * @private\n   */\n  var createPreview = function () {\n    return '<div class=\"sp-editor-preview sp-editor-content\"></div>';\n  };\n\n  /**\n   * Check whether the 'html' contains any twig code that exists within HTML nodes or its' attributes.\n   *\n   * @param html\n   * @returns {boolean}\n   */\n  var containsTwig = function (html) {\n    var parser = new DOMParser(),\n      doc = parser.parseFromString(html, \"text/html\");\n\n    var items = doc.getElementsByTagName(\"*\");\n    for (var i = items.length; i--;) {\n      // Get the Element.\n      var node = items[i];\n\n      // Remove any whitelisted attributes.\n      if (whitelisted.hasOwnProperty(node.tagName.toLowerCase())) {\n        var attributes = whitelisted[node.tagName.toLowerCase()];\n\n        for (var c = attributes.length; c--;) {\n          if (node.hasAttribute(attributes[c])) {\n            node.removeAttribute(attributes[c]);\n          }\n        }\n      }\n\n      // Get the node value (not including any children).\n      var node_html = node.innerHTML\n        ? node.outerHTML.slice(0,node.outerHTML.indexOf(node.innerHTML))\n        : node.outerHTML;\n\n      // Check if the node contains any twig.\n      if (/<[^{>]*(\\{\\{(?:[^}]+|}(?!}))*}}|\\{%(?:[^%]+|%(?!}))*%})[^>]*>/gi.test(node_html)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  /**\n   * Check whether the html contains {{ operator.reply_template }} and show a warning.\n   *\n   * @param html\n   */\n  var containsReplyTemplate = function (html) {\n    // Check if the editor contains {{ operator.reply_template }}\n    if (/\\{\\{\\s*operator\\.reply_template(\\|raw)?\\s*}}/.test(html)) {\n      if (! $container.find('.twig-sig-warning').length) {\n        $container.append(\n          $('<div>', { class: \"sp-alert sp-alert-warning sp-mt-3 sp-mb-0 twig-sig-warning\", text: Lang.get('core.twig_operator_reply_template') })\n        );\n      }\n    } else {\n      $container.find('.twig-sig-warning').remove();\n    }\n  };\n\n  /**\n   * Changed callback function.\n   *\n   * @param html\n   */\n  this.callback = function (html) {\n    // Check if the editor contains {{ operator.reply_template }}.\n    containsReplyTemplate(html);\n\n    // Check any twig code exists within HTML nodes or its' attributes.\n    if (containsTwig(html)) {\n      // Add a warning if there isn't one already\n      if (! $container.find('.twig-html-warning').length) {\n        $container.append(\n          $('<div>', {class: \"sp-alert sp-alert-warning sp-mt-3 sp-mb-0 twig-html-warning\", text: Lang.get('core.twig_html_warning')})\n        );\n      }\n    } else {\n      // Remove warning if it exists\n      $container.find('.twig-html-warning').remove();\n    }\n  };\n\n  /**\n   * Show the visual preview.\n   *\n   * @return {void}\n   */\n  this.showPreview = function () {\n    var errorHandler = function (message) {\n      // Change the view back to how it was originally.\n      $toolbar.find('button:visible').prop('disabled', false).trigger('click');\n\n      Swal.fire(Lang.get('messages.error'), message || Lang.get('messages.general_error'), 'error');\n    };\n\n    // Determine the height of the editor.\n    $toolbar.find('button.switch-view').prop('disabled', true);\n    $preview.html('')\n      .css($editor.position())\n      .css('width', $editor.outerWidth(true))\n      .css('height', $editor.outerHeight(true))\n      .addClass('loadinggif').show();\n\n    // If the form has an input called brand_id, use that value else fall back to the\n    // data-brand set on form-row. If nothing is set then it won't be included.\n    var brandId = $container.parents('form').find(':input[name=\"brand_id\"]').length\n      ? $container.parents('form').find(':input[name=\"brand_id\"]').val()\n      : $container.parents('.sp-form-row').data('brand');\n\n    // Get ticket ID.\n    var ticketId = $container.parents('form').find(':input[name=\"ticket_id\"]').length\n      ? $container.parents('form').find(':input[name=\"ticket_id\"]').val()\n      : null;\n\n    // Attempt to get locale.\n    var locale = $container.parents('.sp-form-container').find(':input[name$=\"[language]\"]').length\n      ? $container.parents('.sp-form-container').find(':input[name$=\"[language]\"]').val()\n      : Lang.locale();\n\n    $.post(\n      laroute.route('core.operator.emailtemplate.preview'),\n      {\n        'template': valFn(),\n        'locale': locale,\n        'template_id': $container.parents('form').data('templateId'),\n        'brand_id': brandId,\n        'ticket_id': ticketId,\n        'is_email': (parameters.syntaxEmailTemplate || false) ? 1 : 0\n      }\n    )\n      .done(function (json) {\n        if (typeof json.data !== 'undefined') {\n          // Inject the HTML (this should be sanitized server-side).\n          $preview.html(json.data);\n        } else {\n          errorHandler();\n        }\n      })\n      .fail(function (jqXHR, textStatus, errorThrown) {\n        try {\n          var json = JSON.parse(jqXHR.responseText);\n\n          errorHandler(typeof json.message !== 'undefined' ? json.message : errorThrown);\n        } catch (e) {\n          errorHandler(errorThrown);\n        }\n      })\n      .always(function () {\n        $toolbar.find('button.switch-view').prop('disabled', false);\n        $preview.removeClass('loadinggif');\n      });\n  };\n\n  /**\n   * Show the WYSIWYG editor.\n   *\n   * @return {void}\n   */\n  this.showEditor = function () {\n    $preview.hide();\n  };\n\n  /**\n   * Container instance.\n   *\n   * @returns {*}\n   */\n  this.container = function () {\n    return $container;\n  };\n\n  /**\n   * Initialise the container.\n   *\n   * @param {jQuery} $wrapper\n   * @return {void}\n   */\n  this.init = function ($wrapper) {\n    // Add the toolbar after the wrapper.\n    $editor = $wrapper.after(createContainer());\n    $container = $editor.next('.sp-editor-container');\n\n    $preview = $(createPreview()).hide();\n    $container.append($preview);\n\n    $toolbar = $(createToolbar()).on('click', 'button', function (e) {\n      e.preventDefault();\n\n      if ($(this).hasClass('visual-preview')) {\n        instance.showPreview();\n      } else {\n        instance.showEditor();\n      }\n\n      // Switch buttons\n      $container.find('.switch-view').toggle();\n    });\n    $container.append($toolbar);\n  };\n}\n\n/**\n * Translations.\n *\n * @type {object}\n */\nMergeFields.translations = {\n  merge_fields: Lang.get('operator.merge_fields'),\n  merge_fields_desc: Lang.get('operator.merge_fields_desc')\n};\n\n/**\n * Toolbar icon.\n *\n * @type {string}\n */\nMergeFields.icon = '<svg height=\"24\" width=\"24\"><path d=\"M 6.098 7.104 C 6.298 8.404 6.498 8.704 6.498 10.004 C 6.498 10.804 4.998 11.504 4.998 11.504 L 4.998 12.504 C 4.998 12.504 6.498 13.204 6.498 14.004 C 6.498 15.304 6.298 15.604 6.098 16.904 C 5.798 19.004 6.898 20.004 7.898 20.004 C 8.898 20.004 9.998 20.004 9.998 20.004 L 9.998 18.004 C 9.998 18.004 8.198 18.204 8.198 17.004 C 8.198 16.104 8.398 16.104 8.598 14.104 C 8.698 13.204 8.098 12.504 7.498 12.004 C 8.098 11.504 8.698 10.904 8.598 10.004 C 8.298 8.004 8.198 8.004 8.198 7.104 C 8.198 5.904 9.998 6.004 9.998 6.004 L 9.998 4.004 C 9.998 4.004 8.998 4.004 7.898 4.004 C 6.798 4.004 5.798 5.004 6.098 7.104 Z\"></path><path d=\"M 17.898 7.104 C 17.698 8.404 17.498 8.704 17.498 10.004 C 17.498 10.804 18.998 11.504 18.998 11.504 L 18.998 12.504 C 18.998 12.504 17.498 13.204 17.498 14.004 C 17.498 15.304 17.698 15.604 17.898 16.904 C 18.198 19.004 17.098 20.004 16.098 20.004 C 15.098 20.004 13.998 20.004 13.998 20.004 L 13.998 18.004 C 13.998 18.004 15.798 18.204 15.798 17.004 C 15.798 16.104 15.598 16.104 15.398 14.104 C 15.298 13.204 15.898 12.504 16.498 12.004 C 15.898 11.504 15.298 10.904 15.398 10.004 C 15.598 8.004 15.798 8.004 15.798 7.104 C 15.798 5.904 13.998 6.004 13.998 6.004 L 13.998 4.004 C 13.998 4.004 14.998 4.004 16.098 4.004 C 17.198 4.004 18.198 5.004 17.898 7.104 Z\"></path></svg>';\n\n/**\n * Default modal contents.\n *\n * @type {string}\n */\nMergeFields.modalContent = '<section> \\\n                        <span class=\"sp-description\">' + MergeFields.translations.merge_fields_desc + '</span> \\\n                        <br /><br /> \\\n                        <div class=\"sp-merge-fields sp-flex sp-flex-wrap\"> \\\n                        </div> \\\n                      </section>';\n\n/**\n * Ticket merge fields.\n *\n * @param {bool} show_canned_responses\n * @returns {string}\n */\nMergeFields.ticketTemplate = function (show_canned_responses) {\n  show_canned_responses = show_canned_responses || true\n\n  return String()\n    + '<div class=\"sp-w-full lg:sp-w-1/2\">'\n      + '<strong class=\"sp-text-xl\">' + Lang.choice('ticket.ticket', 2) + '</strong>'\n      + '<table>'\n        + '<tr>'\n          + '<td><strong>' + Lang.get('operator.strings') + '</strong></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.id }}\">' + Lang.get('general.id') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.number }}\">' + Lang.get('general.number') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.token }}\">' + Lang.get('core.token') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.subject }}\">' + Lang.get('ticket.subject') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ formatDate(ticket.due_time) }}\">' + Lang.get('ticket.due_time') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ formatDate(ticket.created_at) }}\">' + Lang.get('ticket.created_time') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ formatDate(ticket.updated_at) }}\">' + Lang.get('ticket.last_action') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.lastReply.purified_text|raw }}\">' + Lang.get('ticket.last_message_text') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.frontend_url }}\">' + Lang.get('operator.frontend_url') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.operator_url }}\">' + Lang.get('operator.operator_url') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><strong>' + Lang.choice('ticket.department', 1) + '</strong></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.department.id }}\">' + Lang.get('general.id') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.department.frontend_name }}\">' + Lang.get('general.name') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><strong>' + Lang.choice('general.status', 1) + '</strong></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.status.id }}\">' + Lang.get('general.id') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.status.name }}\">' + Lang.get('general.name') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><strong>' + Lang.choice('ticket.priority', 1) + '</strong></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.priority.id }}\">' + Lang.get('general.id') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.priority.name }}\">' + Lang.get('general.name') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><strong>' + Lang.choice('ticket.sla_plan', 1) + '</strong></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.slaplan.name }}\">' + Lang.get('general.name') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><strong>' + Lang.get('operator.collections') + '</strong></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{% for tag in ticket.tags %}{{ tag.name }}{% endfor %}\">' + Lang.choice('ticket.tag', 2) + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{% for user in ticket.assigned %}{{ user.formatted_name }}{% endfor %}\">' + Lang.get('ticket.assigned_operator') + '</button></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{% for field in ticket.customfields %}{{ field.id }}{% endfor %}\">' + Lang.choice('customfield.customfield', 2) + '</button></td>'\n      + '</tr>'\n      + (! show_canned_responses ? '' :\n      '<tr>'\n        + '<td><br /></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><strong class=\"sp-text-xl\">' + Lang.choice('ticket.cannedresponse', 2) + '</strong></td>'\n      + '</tr>'\n      + '<tr>'\n        + '<td><span class=\"sp-description\">' + Lang.get('operator.merge_field_canned_desc') + '</span></td>'\n      + '</tr>')\n    + '</table>'\n  + '</div>';\n};\n\n/**\n * User and system merge fields.\n *\n * @param {bool} show_organisations\n * @returns {string}\n */\nMergeFields.userAndSystemTemplate = function (show_organisations) {\n  return String()\n    + '<div class=\"sp-w-full sp-mt-6 lg:sp-w-1/2 lg:sp-mt-0\">'\n      + '<strong class=\"sp-text-xl\">' + Lang.choice('user.user', 2) + '</strong>'\n      + '<table>'\n        + '<tr>'\n          + '<td><strong>' + Lang.get('operator.strings') + '</strong></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.id }}\">' + Lang.get('general.id') + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.formatted_name }}\">' + Lang.get('user.formatted_name') + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.firstname }}\">' + Lang.get('user.firstname') + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.lastname }}\">' + Lang.get('user.lastname') + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.email }}\">' + Lang.get('general.email') + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.email_verified }}\">' + Lang.get('user.verified') + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.active }}\">' + Lang.get('user.account_active') + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.country }}\">' + Lang.get('user.country') + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.language_code }}\">' + Lang.choice('general.language', 1) + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ formatDate(user.created_at) }}\">' + Lang.get('ticket.created_time') + '</button></td>'\n        + '</tr>'\n        + (! show_organisations ? '' :\n        '<tr>'\n          + '<td><strong>' + Lang.choice('user.organisation', 1) + '</strong></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.organisation.name }}\">' + Lang.get('general.name') + '</button></td>'\n        + '</tr>')\n        + '<tr>'\n          + '<td><strong>' + Lang.get('operator.collections') + '</strong></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{% for group in user.groups %}{{ group.name }}{% endfor %}\">' + Lang.choice('user.group', 2) + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{% for field in ticket.customfields %}{{ field.id }}{% endfor %}\">' + Lang.choice('customfield.customfield', 2) + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td>'\n            + '<br />'\n            + '<strong class=\"sp-text-xl\">' + Lang.choice('core.brand', 1) + '</strong>'\n          + '</td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><strong>' + Lang.get('operator.strings') + '</strong></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ brand.name }}\">' + Lang.get('core.brand_name') + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ brand.default_email }}\">' + Lang.get('general.email_address') + '</button></td>'\n        + '</tr>'\n        + '<tr>'\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ brand.frontend_url }}\">' + Lang.get('operator.frontend_url') + '</button></td>'\n        + '</tr>'\n      + '</table>'\n    + '</div>';\n};\n\n/**\n * Append merge fields to the modal.\n *\n * @param $modal\n * @param {bool} show_tickets\n * @param {bool} show_canned_responses\n * @param {bool} show_organisations\n * @returns {jQuery}\n */\nMergeFields.appendTo = function ($modal, show_tickets, show_canned_responses, show_organisations) {\n  return $modal.find('.sp-merge-fields')\n    .append(show_tickets ? MergeFields.ticketTemplate(show_canned_responses) : '')\n    .append(MergeFields.userAndSystemTemplate(show_organisations))\n    .find('button')\n    .on('click', function () {\n      $(this).trigger('mergefield:inserted', {value: $(this).data('mf')});\n    })\n};\n\nexport {MergeFields}\n"],"names":["DOMParser","proto","prototype","nativeParse","parseFromString","ex","markup","type","test","doc","document","implementation","createHTMLDocument","toLowerCase","indexOf","documentElement","innerHTML","body","apply","this","arguments","MergeFields","parameters","$container","$toolbar","$preview","$editor","instance","valFn","whitelisted","img","a","callback","html","find","length","append","$","class","text","Lang","get","remove","containsReplyTemplate","items","getElementsByTagName","i","node","hasOwnProperty","tagName","attributes","c","hasAttribute","removeAttribute","node_html","outerHTML","slice","containsTwig","showPreview","errorHandler","message","prop","trigger","Swal","fire","css","position","outerWidth","outerHeight","addClass","show","brandId","parents","val","data","ticketId","locale","post","laroute","route","template","template_id","brand_id","ticket_id","is_email","syntaxEmailTemplate","done","json","fail","jqXHR","textStatus","errorThrown","JSON","parse","responseText","e","always","removeClass","showEditor","hide","container","init","$wrapper","after","next","on","preventDefault","hasClass","toggle","translations","merge_fields","merge_fields_desc","icon","modalContent","ticketTemplate","show_canned_responses","String","choice","userAndSystemTemplate","show_organisations","appendTo","$modal","show_tickets","value"],"mappings":";8CAUA,SAASA,IAGP,IACEC,EAAQD,EAAUE,UAChBC,EAAcF,EAAMG,gBAIxB,IAEE,IAAI,IAAKJ,GAAaI,gBAAgB,GAAI,aAExC,MAEH,CAAC,MAAOC,GAAI,CAEbJ,EAAMG,gBAAkB,SAASE,EAAQC,GACvC,GAAI,4BAA4BC,KAAKD,GAAO,CAC1C,IACEE,EAAMC,SAASC,eAAeC,mBAAmB,IAQnD,OANIN,EAAOO,cAAcC,QAAQ,cAAe,EAC9CL,EAAIM,gBAAgBC,UAAYV,EAGhCG,EAAIQ,KAAKD,UAAYV,EAEhBG,CACb,CACM,OAAON,EAAYe,MAAMC,KAAMC,UAElC,CACH,CCnCA,SAASC,EAAYC,GAInB,IAKIC,EAAYC,EAAUC,EAAUC,EALhCC,EAAWR,KAMbS,EAAQN,EAAWM,MAKjBC,EAAc,CAChBC,IAAO,CAAE,OACTC,EAAK,CAAE,SA0GTZ,KAAKa,SAAW,SAAUC,IAlBE,SAAUA,GAEhC,+CAA+CzB,KAAKyB,GAChDV,EAAWW,KAAK,qBAAqBC,QACzCZ,EAAWa,OACTC,EAAE,QAAS,CAAEC,MAAO,6DAA8DC,KAAMC,KAAKC,IAAI,wCAIrGlB,EAAWW,KAAK,qBAAqBQ,QAExC,CASCC,CAAsBV,IA3DL,SAAUA,GAK3B,IAJA,IAGIW,GAHS,IAAI5C,GACFI,gBAAgB6B,EAAM,aAErBY,qBAAqB,KAC5BC,EAAIF,EAAMT,OAAQW,KAAM,CAE/B,IAAIC,EAAOH,EAAME,GAGjB,GAAIjB,EAAYmB,eAAeD,EAAKE,QAAQpC,eAG1C,IAFA,IAAIqC,EAAarB,EAAYkB,EAAKE,QAAQpC,eAEjCsC,EAAID,EAAWf,OAAQgB,KAC1BJ,EAAKK,aAAaF,EAAWC,KAC/BJ,EAAKM,gBAAgBH,EAAWC,IAMtC,IAAIG,EAAYP,EAAK/B,UACjB+B,EAAKQ,UAAUC,MAAM,EAAET,EAAKQ,UAAUzC,QAAQiC,EAAK/B,YACnD+B,EAAKQ,UAGT,GAAI,kEAAkE/C,KAAK8C,GACzE,OAAO,CAEf,CAEI,OAAO,CACR,CA8BKG,CAAaxB,GASfV,EAAWW,KAAK,sBAAsBQ,SAPhCnB,EAAWW,KAAK,sBAAsBC,QAC1CZ,EAAWa,OACTC,EAAE,QAAS,CAACC,MAAO,8DAA+DC,KAAMC,KAAKC,IAAI,4BAOxG,EAODtB,KAAKuC,YAAc,WACjB,IAAIC,EAAe,SAAUC,GAE3BpC,EAASU,KAAK,kBAAkB2B,KAAK,YAAY,GAAOC,QAAQ,SAEhEC,KAAKC,KAAKxB,KAAKC,IAAI,kBAAmBmB,GAAWpB,KAAKC,IAAI,0BAA2B,QACtF,EAGDjB,EAASU,KAAK,sBAAsB2B,KAAK,YAAY,GACrDpC,EAASQ,KAAK,IACXgC,IAAIvC,EAAQwC,YACZD,IAAI,QAASvC,EAAQyC,YAAW,IAChCF,IAAI,SAAUvC,EAAQ0C,aAAY,IAClCC,SAAS,cAAcC,OAI1B,IAAIC,EAAUhD,EAAWiD,QAAQ,QAAQtC,KAAK,2BAA2BC,OACrEZ,EAAWiD,QAAQ,QAAQtC,KAAK,2BAA2BuC,MAC3DlD,EAAWiD,QAAQ,gBAAgBE,KAAK,SAGxCC,EAAWpD,EAAWiD,QAAQ,QAAQtC,KAAK,4BAA4BC,OACvEZ,EAAWiD,QAAQ,QAAQtC,KAAK,4BAA4BuC,MAC5D,KAGAG,EAASrD,EAAWiD,QAAQ,sBAAsBtC,KAAK,8BAA8BC,OACrFZ,EAAWiD,QAAQ,sBAAsBtC,KAAK,8BAA8BuC,MAC5EjC,KAAKoC,SAETvC,EAAEwC,KACAC,QAAQC,MAAM,uCACd,CACEC,SAAYpD,IACZgD,OAAUA,EACVK,YAAe1D,EAAWiD,QAAQ,QAAQE,KAAK,cAC/CQ,SAAYX,EACZY,UAAaR,EACbS,SAAa9D,EAAW+D,oBAAgC,EAAI,IAG7DC,MAAK,SAAUC,QACW,IAAdA,EAAKb,KAEdjD,EAASQ,KAAKsD,EAAKb,MAEnBf,GAEH,IACA6B,MAAK,SAAUC,EAAOC,EAAYC,GACjC,IACE,IAAIJ,EAAOK,KAAKC,MAAMJ,EAAMK,cAE5BnC,OAAqC,IAAjB4B,EAAK3B,QAA0B2B,EAAK3B,QAAU+B,EACnE,CAAC,MAAOI,GACPpC,EAAagC,EACvB,CACO,IACAK,QAAO,WACNxE,EAASU,KAAK,sBAAsB2B,KAAK,YAAY,GACrDpC,EAASwE,YAAY,aAC7B,GACG,EAOD9E,KAAK+E,WAAa,WAChBzE,EAAS0E,MACV,EAODhF,KAAKiF,UAAY,WACf,OAAO7E,CACR,EAQDJ,KAAKkF,KAAO,SAAUC,GAEpB5E,EAAU4E,EAASC,MAjNZ,2CAkNPhF,EAAaG,EAAQ8E,KAAK,wBAE1B/E,EAAWY,EAxLJ,2DAwLuB8D,OAC9B5E,EAAWa,OAAOX,GAElBD,EAAWa,EA7MJ,iGAGDG,KAAKC,IAAI,mBAHR,4EAMDD,KAAKC,IAAI,kBANR,mBA6MuBgE,GAAG,QAAS,UAAU,SAAUV,GAC5DA,EAAEW,iBAEErE,EAAElB,MAAMwF,SAAS,kBACnBhF,EAAS+B,cAET/B,EAASuE,aAIX3E,EAAWW,KAAK,gBAAgB0E,QACtC,IACIrF,EAAWa,OAAOZ,EACnB,CACH,CAOAH,EAAYwF,aAAe,CACzBC,aAActE,KAAKC,IAAI,yBACvBsE,kBAAmBvE,KAAKC,IAAI,+BAQ9BpB,EAAY2F,KAAO,60CAOnB3F,EAAY4F,aAAe,kEAC8B5F,EAAYwF,aAAaE,kBAAoB,0LAYtG1F,EAAY6F,eAAiB,SAAUC,GAGrC,OAFAA,EAAwBA,IAAyB,EAE1CC,0EAE+B5E,KAAK6E,OAAO,gBAAiB,GAF5DD,mCAKoB5E,KAAKC,IAAI,oBAL7B2E,mGAQiF5E,KAAKC,IAAI,cAR1F2E,uGAWmF5E,KAAKC,IAAI,kBAX5F2E,sGAckF5E,KAAKC,IAAI,cAd3F2E,wGAiBoF5E,KAAKC,IAAI,kBAjB7F2E,qHAoBiG5E,KAAKC,IAAI,mBApB1G2E,uHAuBmG5E,KAAKC,IAAI,uBAvB5G2E,uHA0BmG5E,KAAKC,IAAI,sBA1B5G2E,4HA6BwG5E,KAAKC,IAAI,4BA7BjH2E,6GAgCyF5E,KAAKC,IAAI,yBAhClG2E,6GAmCyF5E,KAAKC,IAAI,yBAnClG2E,sCAsCkB5E,KAAK6E,OAAO,oBAAqB,GAtCnDD,8GAyC0F5E,KAAKC,IAAI,cAzCnG2E,yHA4CqG5E,KAAKC,IAAI,gBA5C9G2E,sCA+CkB5E,KAAK6E,OAAO,iBAAkB,GA/ChDD,0GAkDsF5E,KAAKC,IAAI,cAlD/F2E,4GAqDwF5E,KAAKC,IAAI,gBArDjG2E,sCAwDkB5E,KAAK6E,OAAO,kBAAmB,GAxDjDD,4GA2DwF5E,KAAKC,IAAI,cA3DjG2E,8GA8D0F5E,KAAKC,IAAI,gBA9DnG2E,sCAiEkB5E,KAAK6E,OAAO,kBAAmB,GAjEjDD,6GAoEyF5E,KAAKC,IAAI,gBApElG2E,sCAuEkB5E,KAAKC,IAAI,wBAvE3B2E,0IA0EsH5E,KAAK6E,OAAO,aAAc,GA1EhJD,0JA6EsI5E,KAAKC,IAAI,4BA7E/I2E,oJAgFgI5E,KAAK6E,OAAO,0BAA2B,GAhFvKD,uBAkFED,EACL,8DAIwC3E,KAAK6E,OAAO,wBAAyB,GAJ7E,2DAO0C7E,KAAKC,IAAI,oCAPnD,oBAD6B,IAlF1B2E,gBA8FT,EAQA/F,EAAYiG,sBAAwB,SAAUC,GAC5C,OAAOH,6FAE+B5E,KAAK6E,OAAO,YAAa,GAFxDD,mCAKoB5E,KAAKC,IAAI,oBAL7B2E,iGAQ+E5E,KAAKC,IAAI,cARxF2E,6GAW2F5E,KAAKC,IAAI,uBAXpG2E,wGAcsF5E,KAAKC,IAAI,kBAd/F2E,uGAiBqF5E,KAAKC,IAAI,iBAjB9F2E,oGAoBkF5E,KAAKC,IAAI,iBApB3F2E,6GAuB2F5E,KAAKC,IAAI,iBAvBpG2E,qGA0BmF5E,KAAKC,IAAI,uBA1B5F2E,sGA6BoF5E,KAAKC,IAAI,gBA7B7F2E,4GAgC0F5E,KAAK6E,OAAO,mBAAoB,GAhC1HD,qHAmCmG5E,KAAKC,IAAI,uBAnC5G2E,uBAqCIG,EACL,mBACqB/E,KAAK6E,OAAO,oBAAqB,GADtD,gHAI+F7E,KAAKC,IAAI,gBAJxG,sBAD0B,IArCzB2E,mBA6CoB5E,KAAKC,IAAI,wBA7C7B2E,8IAgD4H5E,KAAK6E,OAAO,aAAc,GAhDtJD,oJAmDkI5E,KAAK6E,OAAO,0BAA2B,GAnDzKD,+DAwDqC5E,KAAK6E,OAAO,aAAc,GAxD/DD,sCA4DoB5E,KAAKC,IAAI,oBA5D7B2E,oGA+DkF5E,KAAKC,IAAI,mBA/D3F2E,6GAkE2F5E,KAAKC,IAAI,yBAlEpG2E,4GAqE0F5E,KAAKC,IAAI,yBArEnG2E,mCAyET,EAWA/F,EAAYmG,SAAW,SAAUC,EAAQC,EAAcP,EAAuBI,GAC5E,OAAOE,EAAOvF,KAAK,oBAChBE,OAAOsF,EAAerG,EAAY6F,eAAeC,GAAyB,IAC1E/E,OAAOf,EAAYiG,sBAAsBC,IACzCrF,KAAK,UACLuE,GAAG,SAAS,WACXpE,EAAElB,MAAM2C,QAAQ,sBAAuB,CAAC6D,MAAOtF,EAAElB,MAAMuD,KAAK,OAC7D,GACL"}