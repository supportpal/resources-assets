{"version":3,"file":"mergefields.min.js","sources":["../src/operator/mergefields/DOMParser.js","../src/operator/mergefields/index.js"],"sourcesContent":["/*\r\n   * DOMParser HTML extension\r\n   * 2012-09-04\r\n   *\r\n   * By Eli Grey, http://eligrey.com\r\n   * Public domain.\r\n   * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\r\n   */\r\n\r\n/*! @source https://gist.github.com/1129031 */\r\nfunction DOMParser() {\r\n  \"use strict\";\r\n\r\n  var\r\n    proto = DOMParser.prototype\r\n    , nativeParse = proto.parseFromString\r\n  ;\r\n\r\n  // Firefox/Opera/IE throw errors on unsupported types\r\n  try {\r\n    // WebKit returns null on unsupported types\r\n    if ((new DOMParser()).parseFromString(\"\", \"text/html\")) {\r\n      // text/html parsing is natively supported\r\n      return;\r\n    }\r\n  } catch (ex) {}\r\n\r\n  proto.parseFromString = function(markup, type) {\r\n    if (/^\\s*text\\/html\\s*(?:;|$)/i.test(type)) {\r\n      var\r\n        doc = document.implementation.createHTMLDocument(\"\")\r\n      ;\r\n      if (markup.toLowerCase().indexOf('<!doctype') > -1) {\r\n        doc.documentElement.innerHTML = markup;\r\n      }\r\n      else {\r\n        doc.body.innerHTML = markup;\r\n      }\r\n      return doc;\r\n    } else {\r\n      return nativeParse.apply(this, arguments);\r\n    }\r\n  };\r\n}\r\n\r\nexport {DOMParser}\r\n","import {DOMParser} from \"./DOMParser.js\";\r\n\r\n/**\r\n * Merge fields.\r\n *\r\n * @param parameters\r\n * @constructor\r\n */\r\nfunction MergeFields(parameters)\r\n{\r\n  \"use strict\";\r\n\r\n  var instance = this;\r\n\r\n  /**\r\n   * Options.\r\n   */\r\n  var $container, $toolbar, $preview, $editor,\r\n    valFn = parameters.valFn;\r\n\r\n  /**\r\n   * List of node attributes that are permitted to contain twig template code.\r\n   */\r\n  var whitelisted = {\r\n    'img': [ 'src' ],\r\n    'a': [ 'href' ]\r\n  };\r\n\r\n  /**\r\n   * HTML used to wrap plugin contents in the DOM.\r\n   *\r\n   * Use $.wrap() with this function.\r\n   *\r\n   * @returns {string}\r\n   * @private\r\n   */\r\n  var createContainer = function () {\r\n    return '<div class=\"sp-editor-container\"></div>';\r\n  };\r\n\r\n  /**\r\n   * Create the textarea toolbar.\r\n   *\r\n   * @returns {string}\r\n   * @private\r\n   */\r\n  var createToolbar = function () {\r\n    return '' +\r\n      '<div class=\"sp-inline-block sp-mt-3\">' +\r\n        '<button class=\"switch-view visual-preview\" type=\"button\">' +\r\n          Lang.get('general.preview') +\r\n        '</button>' +\r\n        '<button class=\"switch-view code-editor sp-hidden\" type=\"button\">' +\r\n          Lang.get('general.editor') +\r\n        '</button>' +\r\n      '</div>';\r\n  };\r\n\r\n  /**\r\n   * Create the preview HTML.\r\n   *\r\n   * @returns {string}\r\n   * @private\r\n   */\r\n  var createPreview = function () {\r\n    return '<div class=\"sp-editor-preview sp-editor-content\"></div>';\r\n  };\r\n\r\n  /**\r\n   * Check whether the 'html' contains any twig code that exists within HTML nodes or its' attributes.\r\n   *\r\n   * @param html\r\n   * @returns {boolean}\r\n   */\r\n  var containsTwig = function (html) {\r\n    var parser = new DOMParser(),\r\n      doc = parser.parseFromString(html, \"text/html\");\r\n\r\n    var items = doc.getElementsByTagName(\"*\");\r\n    for (var i = items.length; i--;) {\r\n      // Get the Element.\r\n      var node = items[i];\r\n\r\n      // Remove any whitelisted attributes.\r\n      if (whitelisted.hasOwnProperty(node.tagName.toLowerCase())) {\r\n        var attributes = whitelisted[node.tagName.toLowerCase()];\r\n\r\n        for (var c = attributes.length; c--;) {\r\n          if (node.hasAttribute(attributes[c])) {\r\n            node.removeAttribute(attributes[c]);\r\n          }\r\n        }\r\n      }\r\n\r\n      // Get the node value (not including any children).\r\n      var node_html = node.innerHTML\r\n        ? node.outerHTML.slice(0,node.outerHTML.indexOf(node.innerHTML))\r\n        : node.outerHTML;\r\n\r\n      // Check if the node contains any twig.\r\n      if (/<[^{>]*(\\{\\{(?:[^}]+|}(?!}))*}}|\\{%(?:[^%]+|%(?!}))*%})[^>]*>/gi.test(node_html)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  };\r\n\r\n  /**\r\n   * Check whether the html contains {{ operator.reply_template }} and show a warning.\r\n   *\r\n   * @param html\r\n   */\r\n  var containsReplyTemplate = function (html) {\r\n    // Check if the editor contains {{ operator.reply_template }}\r\n    if (/\\{\\{\\s*operator\\.reply_template(\\|raw)?\\s*}}/.test(html)) {\r\n      if (! $container.find('.twig-sig-warning').length) {\r\n        $container.append(\r\n          $('<div>', { class: \"sp-alert sp-alert-warning sp-mt-3 sp-mb-0 twig-sig-warning\", text: Lang.get('core.twig_operator_reply_template') })\r\n        );\r\n      }\r\n    } else {\r\n      $container.find('.twig-sig-warning').remove();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Changed callback function.\r\n   *\r\n   * @param html\r\n   */\r\n  this.callback = function (html) {\r\n    // Check if the editor contains {{ operator.reply_template }}.\r\n    containsReplyTemplate(html);\r\n\r\n    // Check any twig code exists within HTML nodes or its' attributes.\r\n    if (containsTwig(html)) {\r\n      // Add a warning if there isn't one already\r\n      if (! $container.find('.twig-html-warning').length) {\r\n        $container.append(\r\n          $('<div>', {class: \"sp-alert sp-alert-warning sp-mt-3 sp-mb-0 twig-html-warning\", text: Lang.get('core.twig_html_warning')})\r\n        );\r\n      }\r\n    } else {\r\n      // Remove warning if it exists\r\n      $container.find('.twig-html-warning').remove();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Show the visual preview.\r\n   *\r\n   * @return {void}\r\n   */\r\n  this.showPreview = function () {\r\n    var errorHandler = function (message) {\r\n      // Change the view back to how it was originally.\r\n      $toolbar.find('button:visible').prop('disabled', false).trigger('click');\r\n\r\n      Swal.fire(Lang.get('messages.error'), message || Lang.get('messages.general_error'), 'error');\r\n    };\r\n\r\n    // Determine the height of the editor.\r\n    $toolbar.find('button.switch-view').prop('disabled', true);\r\n    $preview.html('')\r\n      .css($editor.position())\r\n      .css('width', $editor.outerWidth(true))\r\n      .css('height', $editor.outerHeight(true))\r\n      .addClass('loadinggif').show();\r\n\r\n    // If the form has an input called brand_id, use that value else fall back to the\r\n    // data-brand set on form-row. If nothing is set then it won't be included.\r\n    var brandId = $container.parents('form').find(':input[name=\"brand_id\"]').length\r\n      ? $container.parents('form').find(':input[name=\"brand_id\"]').val()\r\n      : $container.parents('.sp-form-row').data('brand');\r\n\r\n    // Get ticket ID.\r\n    var ticketId = $container.parents('form').find(':input[name=\"ticket_id\"]').length\r\n      ? $container.parents('form').find(':input[name=\"ticket_id\"]').val()\r\n      : null;\r\n\r\n    // Attempt to get locale.\r\n    var locale = $container.parents('.sp-form-container').find(':input[name$=\"[language]\"]').length\r\n      ? $container.parents('.sp-form-container').find(':input[name$=\"[language]\"]').val()\r\n      : Lang.locale();\r\n\r\n    $.post(\r\n      laroute.route('core.operator.emailtemplate.preview'),\r\n      {\r\n        'template': valFn(),\r\n        'locale': locale,\r\n        'template_id': $container.parents('form').data('templateId'),\r\n        'brand_id': brandId,\r\n        'ticket_id': ticketId,\r\n        'is_email': (parameters.syntaxEmailTemplate || false) ? 1 : 0\r\n      }\r\n    )\r\n      .done(function (json) {\r\n        if (typeof json.data !== 'undefined') {\r\n          // Inject the HTML (this should be sanitized server-side).\r\n          $preview.html(json.data);\r\n        } else {\r\n          errorHandler();\r\n        }\r\n      })\r\n      .fail(function (jqXHR, textStatus, errorThrown) {\r\n        try {\r\n          var json = JSON.parse(jqXHR.responseText);\r\n\r\n          errorHandler(typeof json.message !== 'undefined' ? json.message : errorThrown);\r\n        } catch (e) {\r\n          errorHandler(errorThrown);\r\n        }\r\n      })\r\n      .always(function () {\r\n        $toolbar.find('button.switch-view').prop('disabled', false);\r\n        $preview.removeClass('loadinggif');\r\n      });\r\n  };\r\n\r\n  /**\r\n   * Show the WYSIWYG editor.\r\n   *\r\n   * @return {void}\r\n   */\r\n  this.showEditor = function () {\r\n    $preview.hide();\r\n  };\r\n\r\n  /**\r\n   * Container instance.\r\n   *\r\n   * @returns {*}\r\n   */\r\n  this.container = function () {\r\n    return $container;\r\n  };\r\n\r\n  /**\r\n   * Initialise the container.\r\n   *\r\n   * @param {jQuery} $wrapper\r\n   * @return {void}\r\n   */\r\n  this.init = function ($wrapper) {\r\n    // Add the toolbar after the wrapper.\r\n    $editor = $wrapper.after(createContainer());\r\n    $container = $editor.next('.sp-editor-container');\r\n\r\n    $preview = $(createPreview()).hide();\r\n    $container.append($preview);\r\n\r\n    $toolbar = $(createToolbar()).on('click', 'button', function (e) {\r\n      e.preventDefault();\r\n\r\n      if ($(this).hasClass('visual-preview')) {\r\n        instance.showPreview();\r\n      } else {\r\n        instance.showEditor();\r\n      }\r\n\r\n      // Switch buttons\r\n      $container.find('.switch-view').toggle();\r\n    });\r\n    $container.append($toolbar);\r\n  };\r\n}\r\n\r\n/**\r\n * Translations.\r\n *\r\n * @type {object}\r\n */\r\nMergeFields.translations = {\r\n  merge_fields: Lang.get('operator.merge_fields'),\r\n  merge_fields_desc: Lang.get('operator.merge_fields_desc')\r\n};\r\n\r\n/**\r\n * Toolbar icon.\r\n *\r\n * @type {string}\r\n */\r\nMergeFields.icon = '<svg height=\"24\" width=\"24\"><path d=\"M 6.098 7.104 C 6.298 8.404 6.498 8.704 6.498 10.004 C 6.498 10.804 4.998 11.504 4.998 11.504 L 4.998 12.504 C 4.998 12.504 6.498 13.204 6.498 14.004 C 6.498 15.304 6.298 15.604 6.098 16.904 C 5.798 19.004 6.898 20.004 7.898 20.004 C 8.898 20.004 9.998 20.004 9.998 20.004 L 9.998 18.004 C 9.998 18.004 8.198 18.204 8.198 17.004 C 8.198 16.104 8.398 16.104 8.598 14.104 C 8.698 13.204 8.098 12.504 7.498 12.004 C 8.098 11.504 8.698 10.904 8.598 10.004 C 8.298 8.004 8.198 8.004 8.198 7.104 C 8.198 5.904 9.998 6.004 9.998 6.004 L 9.998 4.004 C 9.998 4.004 8.998 4.004 7.898 4.004 C 6.798 4.004 5.798 5.004 6.098 7.104 Z\"></path><path d=\"M 17.898 7.104 C 17.698 8.404 17.498 8.704 17.498 10.004 C 17.498 10.804 18.998 11.504 18.998 11.504 L 18.998 12.504 C 18.998 12.504 17.498 13.204 17.498 14.004 C 17.498 15.304 17.698 15.604 17.898 16.904 C 18.198 19.004 17.098 20.004 16.098 20.004 C 15.098 20.004 13.998 20.004 13.998 20.004 L 13.998 18.004 C 13.998 18.004 15.798 18.204 15.798 17.004 C 15.798 16.104 15.598 16.104 15.398 14.104 C 15.298 13.204 15.898 12.504 16.498 12.004 C 15.898 11.504 15.298 10.904 15.398 10.004 C 15.598 8.004 15.798 8.004 15.798 7.104 C 15.798 5.904 13.998 6.004 13.998 6.004 L 13.998 4.004 C 13.998 4.004 14.998 4.004 16.098 4.004 C 17.198 4.004 18.198 5.004 17.898 7.104 Z\"></path></svg>';\r\n\r\n/**\r\n * Default modal contents.\r\n *\r\n * @type {string}\r\n */\r\nMergeFields.modalContent = '<section> \\\r\n                        <span class=\"sp-description\">' + MergeFields.translations.merge_fields_desc + '</span> \\\r\n                        <br /><br /> \\\r\n                        <div class=\"sp-merge-fields sp-flex sp-flex-wrap\"> \\\r\n                        </div> \\\r\n                      </section>';\r\n\r\n/**\r\n * Ticket merge fields.\r\n *\r\n * @param {bool} show_canned_responses\r\n * @returns {string}\r\n */\r\nMergeFields.ticketTemplate = function (show_canned_responses) {\r\n  show_canned_responses = show_canned_responses || true\r\n\r\n  return String()\r\n    + '<div class=\"sp-w-full lg:sp-w-1/2\">'\r\n      + '<strong class=\"sp-text-xl\">' + Lang.choice('ticket.ticket', 2) + '</strong>'\r\n      + '<table>'\r\n        + '<tr>'\r\n          + '<td><strong>' + Lang.get('operator.strings') + '</strong></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.id }}\">' + Lang.get('general.id') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.number }}\">' + Lang.get('general.number') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.token }}\">' + Lang.get('core.token') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.subject }}\">' + Lang.get('ticket.subject') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ formatDate(ticket.due_time) }}\">' + Lang.get('ticket.due_time') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ formatDate(ticket.created_at) }}\">' + Lang.get('ticket.created_time') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ formatDate(ticket.updated_at) }}\">' + Lang.get('ticket.last_action') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.lastReply.purified_text|raw }}\">' + Lang.get('ticket.last_message_text') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.frontend_url }}\">' + Lang.get('operator.frontend_url') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.operator_url }}\">' + Lang.get('operator.operator_url') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><strong>' + Lang.choice('ticket.department', 1) + '</strong></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.department.id }}\">' + Lang.get('general.id') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.department.frontend_name }}\">' + Lang.get('general.name') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><strong>' + Lang.choice('general.status', 1) + '</strong></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.status.id }}\">' + Lang.get('general.id') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.status.name }}\">' + Lang.get('general.name') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><strong>' + Lang.choice('ticket.priority', 1) + '</strong></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.priority.id }}\">' + Lang.get('general.id') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.priority.name }}\">' + Lang.get('general.name') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><strong>' + Lang.choice('ticket.sla_plan', 1) + '</strong></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ ticket.slaplan.name }}\">' + Lang.get('general.name') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><strong>' + Lang.get('operator.collections') + '</strong></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{% for tag in ticket.tags %}{{ tag.name }}{% endfor %}\">' + Lang.choice('ticket.tag', 2) + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{% for user in ticket.assigned %}{{ user.formatted_name }}{% endfor %}\">' + Lang.get('ticket.assigned_operator') + '</button></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{% for field in ticket.customfields %}{{ field.id }}{% endfor %}\">' + Lang.choice('customfield.customfield', 2) + '</button></td>'\r\n      + '</tr>'\r\n      + (! show_canned_responses ? '' :\r\n      '<tr>'\r\n        + '<td><br /></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><strong class=\"sp-text-xl\">' + Lang.choice('ticket.cannedresponse', 2) + '</strong></td>'\r\n      + '</tr>'\r\n      + '<tr>'\r\n        + '<td><span class=\"sp-description\">' + Lang.get('operator.merge_field_canned_desc') + '</span></td>'\r\n      + '</tr>')\r\n    + '</table>'\r\n  + '</div>';\r\n};\r\n\r\n/**\r\n * User and system merge fields.\r\n *\r\n * @param {bool} show_organisations\r\n * @returns {string}\r\n */\r\nMergeFields.userAndSystemTemplate = function (show_organisations) {\r\n  return String()\r\n    + '<div class=\"sp-w-full sp-mt-6 lg:sp-w-1/2 lg:sp-mt-0\">'\r\n      + '<strong class=\"sp-text-xl\">' + Lang.choice('user.user', 2) + '</strong>'\r\n      + '<table>'\r\n        + '<tr>'\r\n          + '<td><strong>' + Lang.get('operator.strings') + '</strong></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.id }}\">' + Lang.get('general.id') + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.formatted_name }}\">' + Lang.get('user.formatted_name') + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.firstname }}\">' + Lang.get('user.firstname') + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.lastname }}\">' + Lang.get('user.lastname') + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.email }}\">' + Lang.get('general.email') + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.email_verified }}\">' + Lang.get('user.verified') + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.active }}\">' + Lang.get('user.account_active') + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.country }}\">' + Lang.get('user.country') + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.language_code }}\">' + Lang.choice('general.language', 1) + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ formatDate(user.created_at) }}\">' + Lang.get('ticket.created_time') + '</button></td>'\r\n        + '</tr>'\r\n        + (! show_organisations ? '' :\r\n        '<tr>'\r\n          + '<td><strong>' + Lang.choice('user.organisation', 1) + '</strong></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ user.organisation.name }}\">' + Lang.get('general.name') + '</button></td>'\r\n        + '</tr>')\r\n        + '<tr>'\r\n          + '<td><strong>' + Lang.get('operator.collections') + '</strong></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{% for group in user.groups %}{{ group.name }}{% endfor %}\">' + Lang.choice('user.group', 2) + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{% for field in ticket.customfields %}{{ field.id }}{% endfor %}\">' + Lang.choice('customfield.customfield', 2) + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td>'\r\n            + '<br />'\r\n            + '<strong class=\"sp-text-xl\">' + Lang.choice('core.brand', 1) + '</strong>'\r\n          + '</td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><strong>' + Lang.get('operator.strings') + '</strong></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ brand.name }}\">' + Lang.get('core.brand_name') + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ brand.default_email }}\">' + Lang.get('general.email_address') + '</button></td>'\r\n        + '</tr>'\r\n        + '<tr>'\r\n          + '<td><button type=\"button\" class=\"sp-button-sm\" data-mf=\"{{ brand.frontend_url }}\">' + Lang.get('operator.frontend_url') + '</button></td>'\r\n        + '</tr>'\r\n      + '</table>'\r\n    + '</div>';\r\n};\r\n\r\n/**\r\n * Append merge fields to the modal.\r\n *\r\n * @param $modal\r\n * @param {bool} show_tickets\r\n * @param {bool} show_canned_responses\r\n * @param {bool} show_organisations\r\n * @returns {jQuery}\r\n */\r\nMergeFields.appendTo = function ($modal, show_tickets, show_canned_responses, show_organisations) {\r\n  return $modal.find('.sp-merge-fields')\r\n    .append(show_tickets ? MergeFields.ticketTemplate(show_canned_responses) : '')\r\n    .append(MergeFields.userAndSystemTemplate(show_organisations))\r\n    .find('button')\r\n    .on('click', function () {\r\n      $(this).trigger('mergefield:inserted', {value: $(this).data('mf')});\r\n    })\r\n};\r\n\r\nexport {MergeFields}\r\n"],"names":["DOMParser","proto","prototype","nativeParse","parseFromString","ex","markup","type","test","doc","document","implementation","createHTMLDocument","toLowerCase","indexOf","documentElement","innerHTML","body","apply","this","arguments","MergeFields","parameters","$container","$toolbar","$preview","$editor","instance","valFn","whitelisted","img","a","callback","html","find","length","append","$","class","text","Lang","get","remove","containsReplyTemplate","items","getElementsByTagName","i","node","hasOwnProperty","tagName","attributes","c","hasAttribute","removeAttribute","node_html","outerHTML","slice","containsTwig","showPreview","errorHandler","message","prop","trigger","Swal","fire","css","position","outerWidth","outerHeight","addClass","show","brandId","parents","val","data","ticketId","locale","post","laroute","route","template","template_id","brand_id","ticket_id","is_email","syntaxEmailTemplate","done","json","fail","jqXHR","textStatus","errorThrown","JSON","parse","responseText","e","always","removeClass","showEditor","hide","container","init","$wrapper","after","next","on","preventDefault","hasClass","toggle","translations","merge_fields","merge_fields_desc","icon","modalContent","ticketTemplate","show_canned_responses","String","choice","userAndSystemTemplate","show_organisations","appendTo","$modal","show_tickets","value"],"mappings":"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"}